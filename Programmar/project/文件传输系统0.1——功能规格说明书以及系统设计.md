

# 前言

由于系统比较简单，功能规格说明和系统设计写在同一篇文章。


# 功能规格说明

1. 用户可以通过调用`POST`请求上传本地文件到目标Linux机器。
2. 用户可以通过调用`GET`请求从目标Linux机器下载文件到本地。
3. 用户可以通过调用API查询正在上传的任务进度。
4. 下载任务的进度显示交由浏览器的默认进度实现。
5. 用户调用`HTTP`API时，系统需要使用TLSv1.3进行连接。
6. 系统需要做到部署方便，能快速部署，以及具备伸缩性。
7. 系统仅需要支持密码登录Linux系统。



# 系统设计


## 技术要求

1. Golang
2. redis
3. docker


## API定义

### 文件上传

#### 上传任务初始化

POST /file/upload/initialization

**请求头**

|参数     |是否必选|类型|描述|
|:-------:|:-----:|:-----:|:----:|
|Content-Type|是|string|“application/json;charset=utf8” |

**请求体**

|参数     |是否必选|类型|描述|
|:-------:|:-----:|:-----:|:----:|
|resource|是|Object|目标资源信息|
|path|是|string|传输路径，绝对路径|
|filename|是|string|文件名|

resource参数

|参数     |是否必选|类型|描述|
|:-------:|:-----:|:-----:|:----:|
|address|是|string|目标资源地址|
|port|是|number|目标资源端口号|
|account|是|object|登录资源的账号信息|

account参数

|参数     |是否必选|类型|描述|
|:-------:|:-----:|:-----:|:----:|
|name|是|string|目标资源登录用户名|
|password|是|string|登录密码|


**响应体**

**正常响应**

Response 200 OK

|参数     |类型|描述|
|:-------:|:-----:|:----:|
|data|object|正常响应内容|

data参数

|参数     |类型|描述|
|:-------:|:-----:|:----:|
|taskId|string|初始化后的任务id|

**通用异常响应**

Response 400 BadRequest

|参数     |类型|描述|
|:-------:|:-----:|:----:|
|error|object|异常响应内容|

error参数

|参数     |类型|描述|
|:-------:|:-----:|:----:|
|message|string|异常响应错误信息|
|code|string|异常响应错误代码|

其中错误代码使用英文大驼峰缩写。

#### 上传文件

POST /file/upload

**URL参数**

|参数     |是否必选|类型|描述|
|:-------:|:-----:|:-----:|:----:|
|taskId|是|string|任务id|

**请求体**
- 文件流

**响应体**

**正常响应**

Response 204 NoContent

**异常响应**

- 通用异常响应

### 文件下载

#### 文件下载初始化

POST /file/download/initialization

- 请求头与请求体与**上传任务初始化**一致
- 响应与**上传任务初始化**一致

#### 下载文件

GET /file/download

- URL参数与**上传文件**一致

**正常响应**

Response 200 OK

**异常响应**
- 通用异常响应

### 进度查询
GET /record/{taskId}

**正常响应**

Response 200 OK

|参数     |类型|描述|
|:-------:|:-----:|:----:|
|data|object|正常响应内容|

data参数

|参数     |类型|描述|
|:-------:|:-----:|:----:|
|rate|number|进度比率 0~100|
|status|string|传输状态描述|

# 任务规划

1. 文件传输模块
2. 文件上传业务模块
3. 文件下载业务模块
4. web模组
5. TLSv1.3加固
6. 抽象化任务数据存储
7. 任务数据存储于redis
8. 容器化

